# キャッシュ

**Database > EasyCache > コンソール使用ガイド > キャッシュ**

キャッシュは仮想機器とエンジン(Valkey及び旧Redis)をインストールしたノードを管理する概念であり、EasyCacheサービス内で最大のリソース単位です。
1つのキャッシュは複数のノードで構成されており、キャッシュに属するノードはキャッシュのエンジンバージョンとポート、パスワード、パラメータグループ、セキュリティグループなどの情報を共有します。

* 使用可能なポート範囲は10000 ～ 12000の間です。
* 現在Valkeyエンジンを提供しており、Redisの場合、すでに作成したキャッシュのみサポートします。
* キャッシュは32バイトのIDを自動的に発行して提供します。
* キャッシュの名前はユーザーが入力及び修正でき、以下の制約事項があります。
* 20文字以内の文字と数字、及び一部の記号(-, \_ )のみ使用できます。

提供するキャッシュのタイプは次のとおりです。

| タイプ | 説明 |
| --- | --- |
| 単一ノードキャッシュ | 1つのマスターノードのみで構成されたキャッシュ |
| 高可用性キャッシュ | 1つのマスターノードと1つ以上のリードレプリカノードで構成されたキャッシュ |

## ノード

ノードは実際にエンジン(Valkey及び旧Redis)とエンジンをインストールした仮想機器を指す基本リソース単位です。
1つのノードには1つのValkeyがインストールされ、基本的にキャッシュが共有する情報に従います。
ノードは32バイトのIDを自動的に発行して提供します。
ノードの名前はキャッシュの名前に「-数字/文字」を追加して自動的に作成されるため、変更できません。

提供するノードのタイプは次のとおりです。

| タイプ | 説明 |
| --- | --- |
| マスターノード | 読み取りと書き込みの両方を提供するマスターノード |
| リードレプリカノード(マスターノードと同一リージョンの場合) | 読み取りのみを提供する読み取り専用レプリカノードで、フェイルオーバー時にリードレプリカノードの1つがマスターノードに変更されます。 |
| リードレプリカノード(マスターノードと異なるリージョンの場合) | 読み取りのみを提供する読み取り専用レプリカノードですが、障害発生時にフェイルオーバーを実行しません。 |
| 高可用性制御ノード | マスターノードとリードレプリカノードを含め、高可用性を制御するための個別ノードで、リードレプリカノードを1つ以上追加する場合に自動的に作成されます。 |

## キャッシュ作成

以下の設定を使用してキャッシュを作成できます。

### アベイラビリティゾーン

NHN Cloudは物理ハードウェアの問題による障害に備えるため、システム全体を複数のアベイラビリティゾーンに分割しています。このアベイラビリティゾーンごとにストレージシステム、ネットワークスイッチ、ラック、電源装置が全て別途構成されています。1つのアベイラビリティゾーン内で発生する障害は他のアベイラビリティゾーンに影響を与えないため、サービス全体の可用性が高まります。EasyCacheはマスターノードのアベイラビリティゾーンを選択でき、この時選択したアベイラビリティゾーンを基準にリードレプリカノードのアベイラビリティゾーンを自動的に割り当てて可用性を高めます。複数のアベイラビリティゾーンに分散して作成されたノード間のネットワーク通信過程で発生するネットワーク使用費用は請求されません。

!!! danger "注意"
    作成済みのマスターノードのアベイラビリティゾーンは変更できません。

### エンジンバージョン

以下に明記されたバージョンを使用できます。

| バージョン | 備考 |
| --- | --- |
| **Valkey 8** |  |
| 8.0.2 |  |
| **Redis 7** | 新規キャッシュサポート終了 |
| 7.2.6 |  |
| 7.2.4 |  |
| 7.0.7 |  |
| **Redis 6** | 新規キャッシュサポート終了 |
| 6.2.3 |  |
| **Redis 5** | 新規キャッシュサポート終了 |
| 5.0.8 |  |
| **Redis 3** | 新規キャッシュサポート終了 |
| 3.2.12 |  |

!!! tip 「ポイント」
    新規作成するキャッシュにはRedisをこれ以上提供せず、すでにRedisを使用中のキャッシュに対してのみサービスを提供します。

### インスタンスタイプ

インスタンスはタイプによって異なるCPUコア数とメモリ容量を持っています。
インスタンス作成時、データベースのワークロードに応じて適切なインスタンスタイプを選択する必要があります。

| タイプ | 説明 |
| --- | --- |
| m2 | CPUとメモリをバランスよく設定したタイプです。 |
| c2 | CPUの性能を高く設定したインスタンスタイプです。 |
| r2 | 他のリソースに比べてメモリの使用量が多い場合に使用できます。 |
| x1 | 高仕様のCPUとメモリをサポートするタイプです。高い性能が必要なサービスやアプリケーションに使用します。 |

!!! danger "注意"
    作成済みのキャッシュ及びノードのインスタンスタイプは変更できません。現在公式機能として提供しておらず、必要時にカスタマーセンターへお問い合わせください。

### Max Memory(MB)

Valkeyが使用する最大メモリ容量を指定して、同期やバックアップ実行時のメモリ不足を予防できます。
必要な時にキャッシュ修正機能を通じてメモリ容量を柔軟に確保できます。

### パスワード使用

パスワード使用を選択する場合、自動的に文字列を生成してパスワードを指定します。
キャッシュ作成完了後、キャッシュ基本情報またはノード基本情報で確認できます。

### ネットワーク

キャッシュに属するノードに接続するVPCサブネットを選択する必要があります。同じサブネットに接続されたComputeサービスのインスタンス間では、別途フローティングIPなしで通信でき、ネットワークトラフィックに対する費用が請求されません。ノードは基本的に全てのネットワークアクセスを遮断するため、接続を希望する場合はDBセキュリティグループを適用する必要があります。

!!! danger "注意"
    作成済みのキャッシュとノードのサブネットは変更できません。

### フローティングIP

外部からノードにアクセスするには、フローティングIPをマスターノードに接続する必要があります。Internet Gatewayが接続されたサブネットを接続する場合のみフローティングIPを作成できます。フローティングIPは使用と同時に課金され、これとは別にフローティングIPを通じたインターネット方向のトラフィックが発生した場合、別途課金されます。
フローティングIPを使用する場合、フローティングIPのためのフローティングIPドメインが一緒に作成され、キャッシュ基本情報及びマスターノードの基本情報で確認できます。

### パラメータグループ

パラメータグループは、キャッシュに属するノードのValkeyに関するパラメータの集合です。キャッシュ作成時に必ず1つのパラメータグループを選択する必要があります。パラメータグループは作成後も自由に変更が可能です。パラメータグループに関する詳細な説明は**@パラメータグループ**項目を参照してください。

### DBセキュリティグループ

DBセキュリティグループは、外部侵入に備えて接続を制限するために使用します。送受信トラフィックに対して特定のポート範囲または指定したポートに対してアクセスを許可できます。
キャッシュに一度に複数のDBセキュリティグループを適用でき、DBセキュリティグループに関する詳細な説明は**@DBセキュリティグループ**項目を参照してください。

### TLS認証

NHN Cloudの**@Certificate Manager**サービスに保存された証明書の中から1つを選択し、TLS証明書で通信できます。

* **TLSサービスポート**: TLS証明書を使用した接続用ポートです。10000以上、12000以下の数字でサービスポートとは異なる設定にする必要があります。
* **TLSサービスポートのみ使用**: TLSサービスポートのみを使用して接続するように設定できます。この機能を有効にする場合、一般サービスポートを使用して接続できません。
* **証明書選択**: Certificate Managerサービスに保存されたTLS証明書の中から1つを選択できます。Certificate ManagerサービスのAppkeyを入力する必要があります。
* Valkeyは公開鍵、秘密鍵及びCA公開鍵を全て必要とします。したがって、使用する証明書には該当するキーが全て含まれている必要があり、該当キーを作成する方法は[Certificate Manager > トラブルシューティングガイド](https://docs.nhncloud.com/ko/Management/Certificate%20Manager/ko/troubleshooting-guide/)を参照してください。

!!! danger "注意"
    レプリケーショングループ作成時点でTLS証明書使用有無を決定すると、後から変更できません。

### バックアップ

キャッシュのValkeyを定期的にバックアップするように設定するか、コンソールを通じて希望する時期にバックアップを作成できます。バックアップはマスターで実行され、実行中にパフォーマンス低下が発生する可能性があります。サービスに影響を与えないために、サービスの負荷が少ない時間にバックアップすることを推奨します。バックアップファイルは内部バックアップストレージに保存され、バックアップ容量に応じて課金されます。予期せぬ障害に備えるため、定期的にバックアップを実行するように設定することを推奨します。バックアップに関する詳細な説明は**@バックアップ**項目を参照してください。

### 基本通知

キャッシュ作成時に基本通知を設定できます。基本通知を設定すると{キャッシュ名}-defaultという名前で新しい通知グループが作成され、以下の通知項目が自動的に設定されます。基本通知として作成された通知グループは自由に修正、削除できます。通知グループに関する詳細な説明は**@通知グループ**項目を参照してください。

基本通知グループの監視設定項目は次のとおりです。

| 項目 | 比較方法 | しきい値 | 持続時間 |
| --- | ----- | --- | ----- |
| CPU使用率 | > | 80% | 10分 |
| メモリ使用量 | >= | 80% | 10分 |
| 接続クライアント数 | > | 9000 | 1分 |
| ブロックされたクライアント数 | > | 1 | 10分 |
| 削除されたキー数 | > | 1 | 10分 |

### 削除保護

削除保護を有効にすると、誤ってキャッシュが削除されないように保護できます。

## キャッシュ及びノードリスト

コンソールで作成したキャッシュを確認できます。キャッシュ単位でキャッシュに属するノードをリストで確認できます。
![cache1.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache1.PNG)

➊: ボタンをクリックしてキャッシュに属するノードリストを折りたたんだり展開したりできます。
➋: 最近収集されたモニタリング指標を表示します。ノードリストが折りたたまれている時はマスターノードのモニタリング指標をキャッシュに表示します。
➌: 現在の状態を確認できます。
➍: 進行中の作業がある場合、スピナーが表示されます。
➎: 検索条件を変更できます。

キャッシュ及びノードの状態は以下のような値で構成され、ユーザーの行為と現在の状態によって変更されます。

| ステータス | 説明 |
| --- | --- |
| REGISTERD | 作成前 |
| STABLE | 使用可能 |
| FAILED\_TO\_CREATE | 作成失敗 |
| FAILED\_TO\_CONNECT | 接続失敗 |
| REPLICATION\_STOP | 複製中断 |
| WARNING | 状態異常 |
| DISABLE | 利用不可 |
| PLANNED\_MIGRATION\_FAILED | マイグレーション失敗 |
| SHUTDOWN | 停止済み |

## キャッシュ及びノード詳細

キャッシュ及びノードを選択すると詳細情報を確認できます。

![cache2.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache2.PNG)

➊: 接続情報のドメインをクリックすると、IP情報を含むドメインの詳細情報を確認できるポップアップウィンドウが表示されます。
➋: DBセキュリティグループをクリックすると、DBセキュリティルールを確認できるポップアップウィンドウが表示されます。
➌: パラメータグループをクリックすると、パラメータを確認できる画面へ移動します。
➍: マウスでドラッグアンドドロップして詳細情報パネルの高さを調節できます。
➎: 詳細情報パネルを予め指定した高さに調整できます。

### 接続情報

キャッシュ作成時に接続ドメインを発行します。接続ドメインはユーザーVPCサブネットに属するIPアドレスを指します。高可用性キャッシュの場合、フェイルオーバーされてリードレプリカの1つが新しいマスターに変更されても接続ドメインは変更されません。したがって特別な理由がなければアプリケーションの接続情報は必ず接続ドメインを利用する必要があります。

フローティングIPを使用した場合、フローティングIPドメインを追加で発行します。フローティングIPドメインはフローティングIPのアドレスを指します。フェイルオーバーされて新しいマスターに交換されても依然として同じフローティングIPとドメインを利用して新しいマスターにアクセスできます。フローティングIPドメインは外部からアクセスが可能なのでDBセキュリティグループのルールを適切に設定してキャッシュを保護する必要があります。

リードレプリカノードがある場合、キャッシュ修正を通じて読み取り専用ドメインを設定できます。読み取り専用ドメインを使用する場合、読み取り専用ドメインに同じキャッシュ及び同じリージョンに属するリードレプリカノードのVPCサブネットに属するIPアドレスを指します。フェイルオーバーされてリードレプリカの1つが新しいマスターに変更された場合、読み取り専用ドメインが指すIP情報も新しく更新されます。

![cache3.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache3.PNG)

### イベント(キャッシュ)

選択したキャッシュが動作したイベントが時間の順序に合わせて表示され、希望する期間を指定して見ることができます。

![cache4.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache4.PNG)

### バックアップ

選択したキャッシュが作成したバックアップリストが表示され、**バックアップ作成**をクリックしてバックアップを作成できます。

![cache5.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache5.PNG)

### ドメイン

キャッシュは全てのドメイン情報を表示していますが、ノード基本情報ではノードの種類別に表示するドメイン情報が異なるため、以下の説明を参照してください。

| ノード種類 | 表示するドメイン情報 |
| ----- | ----------- |
| マスターノード | 接続ドメイン、フローティングIPドメイン |
| リードレプリカノード | 読み取り専用ドメイン |
| 高可用性制御ノード | なし |

### OSバージョン

選択したノードが動作中のOSバージョンを表示します。

![cache6.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache6.PNG)

### モニタリング

選択したノードの各種モニタリング指標を表示します。

![cache7.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache7.PNG)

### イベント(ノード)

選択したノードが動作したイベントが時間の順序に合わせて表示され、希望する期間を指定して見ることができます。

![cache8.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache8.PNG)

### ログ

ノードの**ログ**タブではValkeyのログを希望する期間を指定して見ることができます。**新しいタブで見る**をクリックすると新しいタブで広い画面でログを確認できます。

![cache9.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache9.PNG)

### ユーザー

ノードのユーザータブではValkeyにユーザーを作成、照会、修正、削除できます。

➊: **作成**をクリックすると、希望するユーザーの情報を入力できるポップアップウィンドウが表示されます。
➋: 該当ユーザーの有効化有無を選択できます。
➌: ValkeyがサポートするACL表現式を通じてユーザーに権限を付与できます。
➍: 設定ファイルの**保存**をクリックすると、現在Valkeyメモリに保存されているユーザー情報が設定ファイルに記録され、再起動後もユーザー設定が維持されます。

!!! danger "注意"
    * ユーザー設定はノードごとに設定される情報なので、同じキャッシュに属する他のノードに伝播されません。したがってノードごとにユーザー設定を個別に変更した場合、フェイルオーバーが正常に進行しない可能性があるため注意する必要があります。
    * ノードに作成したユーザー情報は設定ファイルに保存する前にはキャッシュ再起動などの理由で消失する可能性があるため注意する必要があります。

## キャッシュ修正

![cache10.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache10.PNG)
コンソール画面で希望するキャッシュのチェックボックスを選択した後、**修正**をクリックして選択したキャッシュの多様な項目を簡単に変更できます。変更リクエストした項目を順次キャッシュに適用します。適用過程で再起動が必要な場合、全ての変更を適用した後キャッシュを再起動します。変更不可能な項目と再起動が必要な項目は次の通りです。

| 項目 | 変更可否 | 再起動必要有無 | 説明 |
| --- | -------- | --------- | --- |
| アベイラビリティゾーン | いいえ |  |  |
| エンジンバージョン | はい | はい |  |
| Max Memory | はい | いいえ |  |
| インスタンスタイプ | いいえ |  |  |
| キャッシュ名 | はい | いいえ |  |
| キャッシュタイプ | はい | いいえ | キャッシュ修正機能ではなくノード追加削除機能として別途提供 |
| 説明 | はい | いいえ |  |
| パスワード使用 | いいえ |  |  |
| サービスポート | いいえ |  |  |
| マスターノードダウン判定時間 | はい | いいえ |  |
| ネットワーク(VPCサブネット) | いいえ |  |  |
| フローティングIP設定 | はい | いいえ |  |
| 読み取り専用ドメイン | はい | いいえ |  |
| パラメータグループ | はい | 場合による | 変更したパラメータによって再起動可否決定 |
| DBセキュリティグループ | はい | いいえ |  |
| TLS証明書使用 | いいえ |  |  |
| TLSサービスポート | いいえ |  |  |
| TLSサービスポートのみ使用 | いいえ |  |  |
| TLS証明書選択 | はい | いいえ |  |
| バックアップ設定 | はい | いいえ |  |
| 基本通知 | はい | いいえ |  |
| 削除保護 | はい | いいえ |  |

### エンジンバージョン修正

現在キャッシュが使用中のエンジンバージョンからより高いエンジンバージョンに修正してアップグレードを進行できます。
エンジンバージョンのアップグレードはサービス停止または瞬断が発生するため、作業に注意が必要です。
キャッシュに属するリードレプリカノード及び高可用性制御ノードからエンジンバージョンのアップグレードが進行され、ノードのバージョンアップグレードが全て進行されるとマスター変更が起きた後、リードレプリカノードに変わった旧マスターノードのエンジンバージョンをアップグレードするため、最終的にマスターが交換されます。
もしキャッシュに属するノードがマスターノード1つだけなら、すぐにマスターノードのエンジンバージョンアップグレードを実行し、この時サービス停止が発生します。

!!! danger "注意"
    * マスターノードと同じリージョンにリードレプリカノードが存在する場合、最終的にはマスターが変更されるので注意します。

!!! tip 「ポイント」
    * Redis 7.0.7未満のバージョンは7.0.7バージョンに一度アップグレードした後に次のバージョンへアップグレードが可能です。
    * RedisからValkeyへのアップグレードは現在提供していませんが、今後提供する予定です。

## ノード修正

![cache11.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache11.PNG)
コンソール画面で希望するノードのチェックボックスを選択した後、**修正**をクリックして選択したノードの一部項目を変更できます。

| 項目 | 変更可否 | 再起動必要有無 | 説明 |
| --- | -------- | --------- | --- |
| ノード名 | いいえ |  |  |
| ノードタイプ | いいえ |  |  |
| アベイラビリティゾーン | いいえ |  |  |
| エンジンバージョン | いいえ |  | ノード修正画面ではなくキャッシュ修正画面で変更でき、キャッシュに属するノードに順次反映されます。 |
| インスタンスタイプ | いいえ |  | 現在はサポートしていません。(今後サポート予定) |
| OSバージョン | はい | はい | 最新バージョンのみアップデート可能です。 |

### OSバージョン修正

ノードのOSバージョンのアップグレードをサポートします。OSのアップグレードを通じてセキュリティ脆弱性を解決したり、OSのEOLに対応できます。
OSバージョンのアップグレードは場合によってサービス停止が発生するため、注意が必要です。
マスターノードの場合、リードレプリカがあるなら進行できず、リードレプリカノードと高可用性制御ノードからOSバージョンのアップグレードを先に進行した後、マスター変更機能を通じて既存マスターをリードレプリカに変更してからOSバージョンのアップグレードを進行する必要があります。
もし、マスターノード以外に他のノードがなければマスターノードのOSバージョンのアップグレードを進行でき、サービス停止が必ず発生します。

## データインポート

![cache12.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache12.PNG)

同じリージョンの**@Object Storage**からデータをインポートしてキャッシュに適用できます。
ユーザーテナントID、APIパスワードを入力した後、{containerName}/{path or fileName}形式のデータファイルパスを入力して**データインポート**を押すと作業が開始されます。

!!! danger "注意"
    * データインポート中はノードを使用できず、既存データは削除されるため、データインポート前に手動バックアップの作成を推奨します。
    * エンジンバージョンと互換性のあるRDBファイルのみインポートできます。

## データエクスポート

![cache13.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache13.PNG)
希望するキャッシュのデータを同じリージョンの**@Object Storage**にエクスポートできます。
ユーザーテナントID、APIパスワードを入力した後、コンテナ名とデータ名Prefix\*項目を入力して**データエクスポート**をクリックすると作業が開始されます。

!!! tip 「ポイント」
    ユーザーが入力したパスのObject Storageに入力したデータ名prefix値と任意の文字列が合わさったRDBファイルが作成されます。

## ノード追加

![cache14.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache14.PNG)
コンソール画面で希望するキャッシュのチェックボックスを選択した後、**リードレプリカノード追加**をクリックしてリードレプリカノードを追加できます。
単一ノードキャッシュの場合、マスターノードと同じリージョンにリードレプリカノードを初めて追加すると高可用性制御ノードが一緒に作成されます。
リードレプリカノードはマスターノードと同じリージョンに最大2個、マスターノードと異なるリージョン一箇所に1個まで作成できます。
ノード追加が完了するとキャッシュの種類が高可用性キャッシュに変更され、マスターノードで障害が発生した場合、マスターノードと同じリージョンにリードレプリカノードがあればフェイルオーバーを実行してマスターノードが交換されます。

!!! danger "注意"
    異なるリージョンに作成したリードレプリカはマスターノードに障害が発生してもフェイルオーバーされません。

## 複製接続解除及び強制複製接続解除

![cache15.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache15.PNG)
コンソール画面でマスターと異なるリージョンに位置するリードレプリカノードに限り、ノードのチェックボックスを選択した後**複製接続解除**または**強制複製接続解除**機能を使用できます。
複製接続解除機能を使用する場合、元リージョンのマスターから複製接続が解除され新しいマスターに昇格します。

!!! tip 「ポイント」
    * 強制複製接続解除を実行する場合、強制的に複製接続作業を実行するため、元リージョンのキャッシュ及びマスターノード構成情報と不一致が発生する可能性があります。したがって元リージョンの障害状況のような特殊な場合にのみ使用することを推奨します。
    * マスターと同じリージョンのリードレプリカは複製接続解除機能をサポートしません。(今後サポート予定)

## ノード削除

![cache16.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache16.PNG)
コンソール画面で希望する高可用性キャッシュに属するノードのチェックボックスを選択した後、**ノード削除**をクリックしてリードレプリカノードを削除できます。
マスターノードと高可用性制御ノードは指定して削除できません。
選択したリードレプリカノードが削除された後、マスターノードと同じリージョンにこれ以上残りのリードレプリカノードが存在しないなら、高可用性制御ノードも一緒に削除します。

## マスター変更

![cache17.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache17.PNG)
コンソール画面で希望する高可用性キャッシュのチェックボックスを選択した後、マスター変更機能を通じてマスターを変更できます。
既存マスターノードはリードレプリカに変更され、マスターノードと同じリージョンに位置するリードレプリカノードの1つが新しいマスターに変更されます。

## キャッシュ停止

![cache18.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache18.PNG)
動作中のキャッシュの中から希望するものを選択して停止させることができます。
高可用性キャッシュの場合、キャッシュに属する全てのノードが停止されます。

## キャッシュ開始

![cache19.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache19.PNG)
停止されたキャッシュの中から希望するものを選択して再開できます。
高可用性キャッシュの場合、キャッシュに属する全てのノードを開始します。

## キャッシュ再起動

![cache20.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache20.PNG)
コンソール画面でキャッシュの中から希望するものを選択して再開できます。
高可用性キャッシュの場合、キャッシュに属する全てのノードが再起動します。

## パラメータグループ変更事項適用

![cache21.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache21.PNG)
すでにキャッシュが使用中のパラメータグループを**パラメータグループ**タブで修正する場合、該当パラメータグループを使用中のキャッシュとキャッシュに属するノードにすぐには適用されず、代わりにコンソール画面のキャッシュリストに**パラメータ**ボタンが表示され、チェックボックスを選択する場合**パラメータグループ変更事項**項目が有効化されます。

!!! danger "注意"
    パラメータグループ変更事項適用の場合は該当パラメータグループの変更されたパラメータ項目によって再起動が発生する可能性があるため注意する必要があります。

## 高可用性再設定

![cache22.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache22.PNG)
キャッシュの高可用性状態が異常な場合、キャッシュの状態が**状態異常**と表示され、キャッシュリストに**高可用性再設定**ボタンが表示され使用できます。
高可用性再設定を実行する場合、高可用性に関連する設定を再作成したり、高可用性ノードを再作成する作業が実行されます。

## マイグレーション

キャッシュに属するノードの中で仮想機器のプランドマイグレーションが必要な場合、該当ノードにマイグレーションボタンが表示されます。
マイグレーション機能は場合によってサービス停止が発生するため作業に注意が必要です。

!!! tip 「ポイント」
    マスターノードの場合、リードレプリカがあるならボタンは表示されますが無効化され進行できません。リードレプリカノードと高可用性制御ノードからマイグレーションを先に進行し、マスター変更機能を利用して既存マスターをリードレプリカに変更した後、マイグレーションを進行する必要があります。

## キャッシュ削除

使用しなくなったキャッシュはいつでも削除できます。キャッシュを削除する場合、キャッシュに属する全てのノードが一緒に削除されます。削除されたキャッシュ及びノードは復旧できないため、重要なキャッシュは削除保護設定を有効にすることを推奨します。

## バックアップ

障害状況に備えてキャッシュのデータを復元できるよう予め準備できます。必要な時にコンソールでバックアップを実行したり、定期的にバックアップが実行されるように設定できます。詳細は**@バックアップ**項目を参照してください。

## 復元

バックアップを利用してデータを復元できます。復元時、すでに存在するキャッシュに復元するか新しいキャッシュに復元するか選択できます。詳細は**@バックアップ**内の**@復元**項目を参照してください。

## 高可用性キャッシュ

EasyCacheのキャッシュはマスターノードと同じリージョンにリードレプリカノードを追加すると自動的に高可用性制御ノードが作成され、障害発生時にフェイルオーバーを自動的に実行します。

!!! danger "注意"
    高可用性キャッシュを構成するノードがユーザー設定を共有しないため、1つのノードでユーザー設定を変更しても同じキャッシュに属する他のノードに伝播されません。したがってノードごとにユーザー設定を個別に変更した場合、フェイルオーバーが正常に進行しない可能性があるため注意する必要があります。

### 障害検知

![cache24.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache24.PNG)
マスターと同じリージョンにある全てのノードはマスターノードを検知しており、リードレプリカノードを追加する際に入力したマスターノードダウン判定時間を基準に通信失敗可否を決定しフェイルオーバーを実行します。したがってキャッシュ使用に適したマスターノードダウン判定時間を設定することが重要です。

### 自動フェイルオーバー

障害検知を通じて障害可否を探知した場合、ノード間の合意によりマスターと同じリージョンに存在するリードレプリカノードの1つを新規マスターとして選出し、既存のマスターはリードレプリカに変更します。
接続のための接続ドメイン及び読み取り専用ドメイン情報が新しいフェイルオーバーが行われたノードを基準に更新され、フローティングIPドメインは変更されませんがフローティングIPドメインが指すフローティングIPは新しいマスターを指すように自動的に変更されます。

!!! tip 「ポイント」
    フェイルオーバーはマスターノードと同じリージョンに属するノードを対象に実行する機能なので、異なるリージョンのみにリードレプリカノードを追加する場合は自動フェイルオーバーをサポートしません。

### 強制複製接続解除

![cache25.PNG](https://static.toastoven.net/prod_easycache/25.09.27/cache25.PNG)
異なるリージョンに追加したリードレプリカノードの場合、マスター障害時に自動フェイルオーバー対象ではありません。しかし障害発生時に至急他のリージョンにあるリードレプリカノードを使用しなければならない場合、**強制複製接続解除**機能を使用して他のリージョンにあるリードレプリカノードをマスターノードに昇格できます。
**強制複製接続機能解除**を実行する場合、異なるリージョンに既存ノードとは独立した個別キャッシュが新しく作成され、既存のリードレプリカノードがマスターノードに昇格され新しい接続ドメインが表示されます。

!!! tip 「ポイント」
    * 強制複製接続解除を実行する場合、強制的に複製接続作業を実行するため、元リージョンのキャッシュ及びマスターノード構成情報と不一致が発生する可能性があります。したがって元リージョンの障害状況のような特殊な場合にのみ使用し、単純に異なるリージョンのリードレプリカを新しいキャッシュに分離することが目的ならば、一般複製接続解除機能を使用することを推奨します。
    * マスターと同じリージョンのリードレプリカは複製接続解除機能をサポートしません。(今後サポート予定)
