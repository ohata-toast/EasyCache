# キャッシュ

**Database > EasyCache > コンソール使用ガイド > キャッシュ**

キャッシュは、仮想マシンとエンジン(Valkey及び旧Redis)がインストールされたノードを管理する概念であり、EasyCacheサービス内で最も大きなリソース単位です。
1つのキャッシュは複数のノードで構成されており、キャッシュに属するノードは、キャッシュのエンジンバージョン、ポート、パスワード、パラメータグループ、セキュリティグループなどの情報を共有します。

* 使用できるポート範囲は10000～12000です。
* 現在はValkeyエンジンを提供しており、Redisの場合は既に作成済みのキャッシュのみをサポートしています。
* キャッシュには、32バイトのIDが自動的に発行・提供されます。
* キャッシュの名前はユーザーが入力・修正できますが、以下の制約事項があります。
* 20文字以内の英数字と一部の記号(-, _)のみ使用できます。

提供するキャッシュのタイプは次のとおりです。

| タイプ | 説明 |
| --- | --- |
| 単一ノードキャッシュ | 1つのマスターノードのみで構成されるキャッシュ |
| 高可用性キャッシュ | 1つのマスターノードと1つ以上のリードレプリカノードで構成されるキャッシュ |

## ノード

ノードは、実際にエンジン(Valkey及び旧Redis)と、エンジンがインストールされた仮想マシンを指す基本リソース単位です。
1つのノードには1つのValkeyがインストールされ、基本的にはキャッシュが共有する情報に従います。
ノードには、32バイトのIDが自動的に発行・提供されます。
ノードの名前は、キャッシュの名前に「-数字/文字」を付加して自動的に作成されるため、変更できません。

提供するノードのタイプは次のとおりです。

| タイプ | 説明 |
| --- | --- |
| マスターノード | 読み取りと書き込みの両方を提供するマスターノード |
| リードレプリカノード(マスターノードと同一リージョンの場合) | 読み取りのみを提供する読み取り専用のレプリカノードで、フェイルオーバーの際にリードレプリカノードの中からいずれか1つがマスターノードに変更されます。 |
| リードレプリカノード(マスターノードと異なるリージョンの場合) | 読み取りのみを提供する読み取り専用のレプリカノードですが、障害発生時にフェイルオーバーは実行しません。 |
| 高可用性制御ノード | マスターノードとリードレプリカノードを含め、高可用性を制御するための個別ノードで、リードレプリカノードを1つ以上追加すると自動的に作成されます。 |

## キャッシュの作成

以下の設定を使用してキャッシュを作成できます。

### アベイラビリティゾーン

NHN Cloudは、物理的なハードウェアの問題によって生じる障害に備えるため、システム全体を複数のアベイラビリティゾーンに分割しています。アベイラビリティゾーンごとにストレージシステム、ネットワークスイッチ、フロアスペース、電源装置が全て個別に構成されています。1つのアベイラビリティゾーン内で発生した障害は、他のアベイラビリティゾーンに影響を与えないため、サービス全体の可用性が高まります。EasyCacheではマスターノードのアベイラビリティゾーンを選択でき、その際に選択したアベイラビリティゾーンを基準に、リードレプリカノードのアベイラビリティゾーンが自動的に割り当てられ、可用性が向上します。複数のアベイラビリティゾーンに分散して作成されたノード間のネットワーク通信で発生する料金は課金されません。

!!! danger "注意"
  既に作成したマスターノードのアベイラビリティゾーンは変更できません。

### エンジンバージョン

以下に明記されたバージョンを使用できます。

| バージョン | 備考 |
| --- | --- |
| **Valkey 8** |  |
| 8.0.2 |  |
| **Redis 7** | 新規キャッシュのサポート終了 |
| 7.2.6 |  |
| 7.2.4 |  |
| 7.0.7 |  |
| **Redis 6** | 新規キャッシュのサポート終了 |
| 6.2.3 |  |
| **Redis 5** | 新規キャッシュのサポート終了 |
| 5.0.8 |  |
| **Redis 3** | 新規キャッシュのサポート終了 |
| 3.2.12 |  |

!!! tip 「ポイント」
  新規作成するキャッシュではRedisは提供されなくなり、既にRedisを使用中のキャッシュに対してのみサービスを提供します。

### インスタンスタイプ

インスタンスは、タイプによってCPUコア数とメモリ容量が異なります。
インスタンスの作成時、データベースのワークロードに応じて適切なインスタンスタイプを選択する必要があります。

| タイプ | 説明 |
| --- | --- |
| m2 | CPUとメモリをバランスよく設定したタイプです。 |
| c2 | CPUの性能を高く設定したインスタンスタイプです。 |
| r2 | 他のリソースに比べてメモリの使用量が多い場合に使用できます。 |
| x1 | 高スペックのCPUとメモリをサポートするタイプです。高い性能が必要なサービスやアプリケーションで使用します。 |

!!! danger "注意"
  既に作成したキャッシュ及びノードのインスタンスタイプは変更できません。現在、公式機能としては提供しておらず、必要な場合はカスタマーセンターへお問い合わせください。

### Max Memory(MB)

Valkeyが使用する最大メモリ容量を指定することで、同期やバックアップの実行時におけるメモリ不足を予防できます。
必要な時には、キャッシュ修正機能を通じてメモリ容量を柔軟に確保できます。

### パスワードの使用

パスワードの使用を選択すると、文字列が自動的に生成されてパスワードとして指定されます。
キャッシュの作成完了後、キャッシュの基本情報またはノードの基本情報で確認できます。

### ネットワーク

キャッシュに属するノードに接続するVPCサブネットを選択する必要があります。同じサブネットに接続されたComputeサービスのインスタンス間では、別途フローティングIPがなくても通信でき、ネットワークトラフィックに対する料金は請求されません。ノードは基本的に全てのネットワークアクセスを遮断するため、接続したい場合はDBセキュリティグループを適用する必要があります。

!!! danger "注意"
  既に作成したキャッシュとノードのサブネットは変更できません。

### フローティングIP

外部からノードにアクセスするには、フローティングIPをマスターノードに接続する必要があります。Internet Gatewayが接続されたサブネットを割り当てる場合にのみ、フローティングIPを作成できます。フローティングIPは使用と同時に課金され、これとは別に、フローティングIP経由のインターネット方向のトラフィックが発生した場合は別途課金されます。
フローティングIPを使用する場合、フローティングIP用のドメインも同時に作成され、キャッシュの基本情報及びマスターノードの基本情報で確認できます。

### パラメータグループ

パラメータグループは、キャッシュに属するノードのValkeyに関するパラメータの集合です。キャッシュ作成時には、必ず1つのパラメータグループを選択する必要があります。パラメータグループは作成後も自由に変更が可能です。パラメータグループに関する詳細な説明は、**パラメータグループ**の項目をご参照ください。

### DBセキュリティグループ

DBセキュリティグループは、外部からの侵入に備えてアクセスを制限するために使用します。送受信トラフィックに対し、特定のポート範囲または指定したポートへのアクセスを許可できます。
キャッシュには一度に複数のDBセキュリティグループを適用でき、DBセキュリティグループに関する詳細な説明は、**DBセキュリティグループ**の項目をご参照ください。

### TLS認証

NHN Cloudの**Certificate Manager**サービスに保存された証明書の中から1つを選択し、TLS証明書で通信できます。

* **TLSサービスポート**: TLS証明書を使用した接続用のポートです。10000以上、12000以下の数字で、サービスポートとは異なる値に設定する必要があります。
* **TLSサービスポートのみ使用**: TLSサービスポートのみを使用して接続するように設定できます。この機能を有効にした場合、通常のサービスポートでは接続できません。
* **証明書の選択**: Certificate Managerサービスに保存されたTLS証明書の中から1つを選択できます。Certificate ManagerサービスのAppkeyを入力する必要があります。
* Valkeyは、公開鍵、秘密鍵、及びCA公開鍵の全てを必要とします。そのため、使用する証明書には、これらのキーが全て含まれている必要があり、キーの作成方法は[Certificate Manager > トラブルシューティングガイド](https://docs.nhncloud.com/ko/Management/Certificate%20Manager/ko/troubleshooting-guide/)をご参照ください。

!!! danger "注意"
  レプリケーショングループの作成時点でTLS証明書の使用有無を決定すると、それ以降は変更できません。

### バックアップ

キャッシュのValkeyを定期的にバックアップするよう設定したり、コンソールを通じて好きなタイミングでバックアップを作成したりできます。バックアップはマスターで実行され、実行中はパフォーマンスが低下することがあります。サービスに影響を与えないよう、サービスの負荷が少ない時間帯にバックアップすることを推奨します。バックアップファイルは内部のバックアップストレージに保存され、バックアップ容量に応じて課金されます。予期せぬ障害に備えるため、定期的にバックアップを実行する設定にすることを推奨します。バックアップに関する詳細な説明は、**バックアップ**の項目をご参照ください。

### デフォルト通知

キャッシュの作成時に、デフォルトの通知を設定できます。デフォルト通知を設定すると、「{キャッシュ名}-default」という名前で新しい通知グループが作成され、以下の通知項目が自動的に設定されます。デフォルト通知で作成された通知グループは、自由に修正・削除できます。通知グループに関する詳細な説明は、**通知グループ**の項目をご参照ください。

デフォルト通知グループの監視設定項目は、次のとおりです。

| 項目 | 比較方法 | しきい値 | 持続時間 |
| --- | ----- | --- | ----- |
| CPU使用率 | > | 80% | 10分 |
| メモリ使用量 | >= | 80% | 10分 |
| 接続クライアント数 | > | 9000 | 1分 |
| ブロックされたクライアント数 | > | 1 | 10分 |
| 削除されたキーの数 | > | 1 | 10分 |

### 削除保護

削除保護を有効にすると、誤ってキャッシュが削除されるのを防ぐことができます。

## キャッシュ及びノードのリスト

コンソールで作成したキャッシュを確認できます。キャッシュ単位で、それに属するノードをリストで表示できます。
[[キャッシュリストの画像]]

➊:ボタンをクリックすると、キャッシュに属するノードのリストを折りたたんだり展開したりできます。
➋:直近に収集されたモニタリング指標を表示します。ノードリストが折りたたまれている場合は、マスターノードのモニタリング指標をキャッシュに表示します。
➌:現在のステータスを確認できます。
➍:進行中のタスクがある場合、スピナーが表示されます。
➎:検索条件を変更できます。

キャッシュ及びノードのステータスは、以下のような値で構成され、ユーザーのアクションや現在の状態に応じて変化します。

| ステータス | 説明 |
| --- | --- |
| REGISTERD | 作成前 |
| STABLE | 使用可能 |
| FAILED\_TO\_CREATE | 作成失敗 |
| FAILED\_TO\_CONNECT | 接続失敗 |
| REPLICATION\_STOP | レプリケーション中断 |
| WARNING | 異常 |
| DISABLE | 利用不可 |
| PLANNED\_MIGRATION\_FAILED | マイグレーション失敗 |
| SHUTDOWN | 停止済み |

## キャッシュ及びノード詳細

キャッシュ及びノードを選択すると、詳細情報を確認できます。

[[キャッシュ基本情報の画像]]

➊:接続情報のドメインをクリックすると、IP情報を含むドメインの詳細情報を確認できるポップアップウィンドウが表示されます。
➋: DBセキュリティグループをクリックすると、DBセキュリティルールを確認できるポップアップウィンドウが表示されます。
➌:パラメータグループをクリックすると、パラメータを確認できる画面に移動します。
➍:マウスのドラッグ&ドロップで、詳細情報パネルの高さを調節できます。
➎:詳細情報パネルを、事前に指定した高さに調節できます。

### 接続情報

キャッシュの作成時に接続ドメインが発行されます。接続ドメインは、ユーザーのVPCサブネットに属するIPアドレスを指します。高可用性キャッシュの場合、フェイルオーバーによってリードレプリカのいずれかが新しいマスターに変更されても、接続ドメインは変更されません。そのため、特別な理由がない限り、アプリケーションの接続情報には必ず接続ドメインを使用する必要があります。

フローティングIPを使用した場合、フローティングIPドメインが追加で発行されます。フローティングIPドメインは、フローティングIPのアドレスを指します。フェイルオーバーによって新しいマスターに交代しても、引き続き同じフローティングIPとドメインを利用して新しいマスターにアクセスできます。フローティングIPドメインは外部からアクセス可能なため、DBセキュリティグループのルールを適切に設定してキャッシュを保護する必要があります。

リードレプリカノードがある場合、キャッシュの修正を通じて読み取り専用ドメインを設定できます。読み取り専用ドメインを使用する場合、そのドメインは、同じキャッシュかつ同じリージョンに属するリードレプリカノード群のVPCサブネットに属するIPアドレスを指します。フェイルオーバーによってリードレプリカのいずれかが新しいマスターに変更された場合、読み取り専用ドメインが指すIP情報も新たに更新されます。

[[イベントの画像]]

### イベント(キャッシュ)

選択したキャッシュで発生したイベントが時系列で表示され、期間を指定して照会することもできます。

[[バックアップの画像]]

### バックアップ

選択したキャッシュが作成したバックアップのリストが表示され、**バックアップ作成**をクリックしてバックアップを作成できます。

[[ノード基本情報の画像]]

### ドメイン

キャッシュは全てのドメイン情報を表示しますが、ノードの基本情報ではノードの種類ごとに表示されるドメイン情報が異なるため、以下の説明をご参照ください。

| ノードの種類 | 表示されるドメイン情報 |
| ----- | ----------- |
| マスターノード | 接続ドメイン、フローティングIPドメイン |
| リードレプリカノード | 読み取り専用ドメイン |
| 高可用性制御ノード | なし |

### OSバージョン

選択したノードが稼働しているOSのバージョンを表示します。

[[モニタリングの画像]]

### モニタリング

選択したノードの各種モニタリング指標を表示します。

[[イベントの画像]]

### イベント(ノード)

選択したノードで発生したイベントが時系列で表示され、期間を指定して照会することもできます。

[[ログの画像]]

### ログ

ノードの**ログ**タブでは、Valkeyのログを期間を指定して照会できます。**新しいタブで表示**をクリックすると、新しいタブの広い画面でログを確認できます。

[[ユーザーの画像]]

### ユーザー

ノードのユーザータブでは、Valkeyのユーザーを作成、照会、修正、削除できます。

➊: **作成**をクリックすると、希望するユーザーの情報を入力できるポップアップウィンドウが表示されます。
➋:該当ユーザーを有効にするかどうかを選択できます。
➌: ValkeyがサポートするACL表現式を通じて、ユーザーに権限を付与できます。
➍:設定ファイルの**保存**をクリックすると、現在Valkeyのメモリに保存されているユーザー情報が設定ファイルに書き込まれ、再起動後もユーザー設定が維持されます。

!!! danger "注意"
    * ユーザー設定はノードごとに設定される情報のため、同じキャッシュに属する他のノードには伝播されません。そのため、ノードごとにユーザー設定が異なっている場合、フェイルオーバーが正常に行われない可能性があるため注意が必要です。
    * ノードで作成したユーザー情報は、設定ファイルに保存する前は、キャッシュの再起動などによって失われる可能性があるため注意が必要です。

## キャッシュの修正

[[キャッシュ修正アイコンの画像]]
コンソール画面で目的のキャッシュのチェックボックスを選択した後、**修正**をクリックすると、選択したキャッシュの様々な項目を簡単に変更できます。リクエストされた変更項目は、順次キャッシュに適用されます。適用過程で再起動が必要な場合は、全ての変更を適用した後にキャッシュを再起動します。変更不可能な項目と、再起動が必要な項目は次のとおりです。

| 項目 | 変更可否 | 再起動の要否 | 説明 |
| --- | -------- | --------- | --- |
| アベイラビリティゾーン | いいえ |  |  |
| エンジンバージョン | はい | はい |  |
| Max Memory | はい | いいえ |  |
| インスタンスタイプ | いいえ |  |  |
| キャッシュ名 | はい | いいえ |  |
| キャッシュタイプ | はい | いいえ | キャッシュ修正機能ではなく、ノードの追加・削除機能として別途提供 |
| 説明 | はい | いいえ |  |
| パスワードの使用 | いいえ |  |  |
| サービスポート | いいえ |  |  |
| マスターノードのダウン判定時間 | はい | いいえ |  |
| ネットワーク(VPCサブネット) | いいえ |  |  |
| フローティングIP設定 | はい | いいえ |  |
| 読み取り専用ドメイン | はい | いいえ |  |
| パラメータグループ | はい | 場合による | 変更したパラメータによって再起動の要否が決定 |
| DBセキュリティグループ | はい | いいえ |  |
| TLS証明書の使用 | いいえ |  |  |
| TLSサービスポート | いいえ |  |  |
| TLSサービスポートのみ使用 | いいえ |  |  |
| TLS証明書の選択 | はい | いいえ |  |
| バックアップ設定 | はい | いいえ |  |
| デフォルト通知 | はい | いいえ |  |
| 削除保護 | はい | いいえ |  |

### エンジンバージョンの修正

現在キャッシュが使用しているエンジンバージョンから、より新しいエンジンバージョンに修正してアップグレードを行うことができます。
エンジンバージョンのアップグレードは、サービス停止または瞬断が発生するため、作業には注意が必要です。
キャッシュに属するリードレプリカノード及び高可用性制御ノードからエンジンバージョンのアップグレードが開始され、全ノードのアップグレードが完了するとマスターの変更が行われます。その後、リードレプリカノードに変わった旧マスターノードのエンジンバージョンがアップグレードされるため、最終的にマスターが交代します。
もしキャッシュに属するノードがマスターノード1台のみの場合、直ちにマスターノードのエンジンバージョンアップグレードが実行され、その際にサービス停止が発生します。

!!! danger "注意"
    * マスターノードと同じリージョンにリードレプリカノードが存在する場合、最終的にマスターが変更されるためご注意ください。

!!! tip 「ポイント」
    * Redis 7.0.7未満のバージョンは、一度7.0.7バージョンへアップグレードした後に、次のバージョンへアップグレードが可能です。
    * RedisからValkeyへのアップグレードは現在提供していませんが、今後提供する予定です。

## ノードの修正

[[ノード修正アイコンの画像]]
コンソール画面で目的のノードのチェックボックスを選択した後、**修正**をクリックして、選択したノードの一部の項目を変更できます。

| 項目 | 変更可否 | 再起動の要否 | 説明 |
| --- | -------- | --------- | --- |
| ノード名 | いいえ |  |  |
| ノードタイプ | いいえ |  |  |
| アベイラビリティゾーン | いいえ |  |  |
| エンジンバージョン | いいえ |  | ノード修正画面ではなくキャッシュ修正画面で変更でき、キャッシュに属するノードに順次反映されます。 |
| インスタンスタイプ | いいえ |  | 現在はサポートしていません。(今後サポート予定) |
| OSバージョン | はい | はい | 最新バージョンへのみアップデート可能です。 |

### OSバージョンの修正

ノードのOSバージョンアップグレードをサポートします。OSのアップグレードを通じて、セキュリティ脆弱性を解決したり、OSのEOLに対応したりできます。
OSバージョンのアップグレードは、場合によってサービス停止が発生するため、作業には注意が必要です。
マスターノードの場合、リードレプリカが存在すると実行できません。リードレプリカノードと高可用性制御ノードのOSバージョンアップグレードを先に行い、その後マスター変更機能を通じて既存のマスターをリードレプリカに変更してから、OSバージョンアップグレードを行う必要があります。
もし、マスターノード以外のノードがない場合は、マスターノードのOSバージョンアップグレードを実行でき、その際には必ずサービス停止が発生します。

## データのインポート

[[データインポートボタンの画像]]

同じリージョンの**Object Storage**からデータをインポートし、キャッシュに適用できます。
ユーザーのテナントID、APIパスワードを入力した後、`{containerName}/{path or fileName}`形式のデータファイルパスを入力して**データのインポート**を押すと、タスクが開始されます。

!!! danger "注意"
    * データインポート中はノードを使用できず、既存のデータは削除されるため、インポート前の手動バックアップ作成を推奨します。
    * エンジンバージョンと互換性のあるRDBファイルのみインポートできます。

## データのエクスポート

[[データエクスポートボタンの画像]]
目的のキャッシュのデータを、同じリージョンの**Object Storage**へエクスポートできます。
ユーザーのテナントID、APIパスワードを入力した後、コンテナ名とデータ名Prefix*項目を入力して**データのエクスポート**をクリックすると、タスクが開始されます。

!!! tip 「ポイント」
   ユーザーが入力したパスのObject Storageに、入力したデータ名のprefix値とランダムな文字列を組み合わせたRDBファイルが作成されます。

## ノードの追加

[[ノード追加アイコンの画像]]
コンソール画面で目的のキャッシュのチェックボックスを選択した後、**リードレプリカノード追加**をクリックしてリードレプリカノードを追加できます。
単一ノードキャッシュの場合、マスターノードと同じリージョンに初めてリードレプリカノードを追加すると、高可用性制御ノードも同時に作成されます。
リードレプリカノードは、マスターノードと同じリージョンに最大2台、マスターノードと異なるリージョン1か所に1台まで作成できます。
ノードの追加が完了すると、キャッシュの種類が高可用性キャッシュに変更され、マスターノードで障害が発生した場合に、マスターノードと同じリージョンにリードレプリカノードがあればフェイルオーバーが実行されてマスターノードが交代します。

!!! danger "注意"
   他のリージョンに作成したリードレプリカは、マスターノードに障害が発生してもフェイルオーバーの対象にはなりません。

## レプリケーション接続の解除及び強制解除

[[レプリケーション接続解除アイコンの画像]]
コンソール画面で、マスターと異なるリージョンに配置されているリードレプリカノードに限り、ノードのチェックボックスを選択した上で**レプリケーション接続の解除**または**レプリケーション接続の強制解除**機能を使用できます。
レプリケーション接続の解除機能を使用する場合、元のリージョンのマスターからのレプリケーション接続が解除され、新しいマスターに昇格します。

!!! tip 「ポイント」
    * レプリケーション接続の強制解除を実行する場合、強制的にレプリケーション接続タスクを行うため、元のリージョンのキャッシュ及びマスターノードの構成情報との間に不整合が発生する可能性があります。そのため、元のリージョンでの障害発生時のような特殊な場合にのみ使用することを推奨します。
    * マスターと同じリージョンのリードレプリカは、レプリケーション接続の解除機能をサポートしていません。(今後サポート予定)

## ノードの削除

[[ノード削除アイコンの画像]]
コンソール画面で、目的の高可用性キャッシュに属するノードのチェックボックスを選択した後、**ノード削除**をクリックしてリードレプリカノードを削除できます。
マスターノードと高可用性制御ノードは、指定して削除することはできません。
選択したリードレプリカノードの削除後、マスターノードと同じリージョンに残っているリードレプリカノードが存在しなくなった場合、高可用性制御ノードも同時に削除します。

## マスターの変更

[[キャッシュマスター変更アイコンの画像]]
コンソール画面で目的の高可用性キャッシュのチェックボックスを選択した後、マスター変更機能を通じてマスターを変更できます。
既存のマスターノードはリードレプリカに変更され、マスターノードと同じリージョンに配置されているリードレプリカノードのいずれか1つが新しいマスターに変更されます。

## キャッシュの停止

[[キャッシュ停止アイコンの画像]]
稼働中のキャッシュの中から、目的のものを選択して停止させることができます。
高可用性キャッシュの場合、それに属する全てのノードが停止します。

## キャッシュの起動

[[キャッシュ起動アイコンの画像]]
停止中のキャッシュの中から、目的のものを選択して再起動できます。
高可用性キャッシュの場合、それに属する全てのノードを起動します。

## キャッシュの再起動

[[キャッシュ起動アイコンの画像]]
コンソール画面で、目的のキャッシュを選択して再起動できます。
高可用性キャッシュの場合、それに属する全てのノードが再起動します。

## パラメータグループの変更内容の適用

[[パラメータグループ変更内容適用の画像]]
既にキャッシュが使用しているパラメータグループを**パラメータグループ**タブで修正した場合、そのパラメータグループを使用中のキャッシュ及びそれに属するノードに直ちには適用されません。その代わり、コンソール画面のキャッシュリストに**パラメータ**ボタンが表示され、チェックボックスを選択すると**パラメータグループの変更内容**項目が有効になります。

!!! danger "注意"
   パラメータグループの変更内容を適用する際、変更されたパラメータ項目によっては再起動が発生することがあるため、注意が必要です。

## 高可用性の再設定

[[高可用性再設定ボタンの画像]]
キャッシュの高可用性ステータスが異常の場合、キャッシュのステータスが**異常**と表示され、キャッシュリストに**高可用性の再設定**ボタンが表示されて使用可能になります。
高可用性の再設定を実行すると、高可用性に関する設定を再作成したり、高可用性ノードを再生成したりするタスクが実行されます。

## マイグレーション

[[マイグレーションボタン表示の画像]]
キャッシュに属するノードの中に、仮想マシンの計画的マイグレーションが必要なものがある場合、該当ノードにマイグレーションボタンが表示されます。
マイグレーション機能は、場合によってサービス停止が発生するため、作業には注意が必要です。

!!! tip 「ポイント」
   マスターノードの場合、リードレプリカが存在するとボタンは表示されますが無効化されており、実行できません。リードレプリカノードと高可用性制御ノードのマイグレーションを先に行い、マスター変更機能を利用して既存のマスターをリードレプリカに変更してから、マイグレーションを行う必要があります。

## キャッシュの削除

使用しなくなったキャッシュは、いつでも削除できます。キャッシュを削除すると、それに属する全てのノードも一緒に削除されます。削除されたキャッシュ及びノードは復旧できないため、重要なキャッシュでは削除保護設定を有効にすることを推奨します。

## バックアップ

障害状況に備え、キャッシュのデータを復元できるよう事前に準備しておくことができます。必要な時にコンソールでバックアップを実行したり、定期的にバックアップが実行されるように設定したりすることが可能です。詳細は、**バックアップ**の項目をご参照ください。

## 復元

バックアップを利用してデータを復元できます。復元の際、既存のキャッシュに復元するか、新しいキャッシュに復元するかを選択できます。詳細は、**バックアップ**内の**復元**項目をご参照ください。

## 高可用性キャッシュ

EasyCacheのキャッシュは、マスターノードと同じリージョンにリードレプリカノードを追加すると、自動的に高可用性制御ノードが作成され、障害発生時に自動でフェイルオーバーを実行します。

!!! danger "注意"
   高可用性キャッシュを構成する各ノードはユーザー設定を共有しないため、1つのノードでユーザー設定を変更しても、同じキャッシュに属する他のノードには伝播されません。そのため、ノードごとにユーザー設定が異なっている場合、フェイルオーバーが正常に行われない可能性があるため注意が必要です。

### 障害検知

[[ノード追加ポップアップ画面の画像]]
マスターと同じリージョンにある全てのノードはマスターノードを監視しており、リードレプリカノードの追加時に入力したマスターノードのダウン判定時間に基づき、通信の失敗を判断してフェイルオーバーを実行します。そのため、キャッシュの利用に適したマスターノードのダウン判定時間を設定することが重要です。

### 自動フェイルオーバー

障害検知を通じて障害が検知されると、ノード間の合意に基づき、マスターと同じリージョンに存在するリードレプリカノードの中から1つが新しいマスターとして選出され、既存のマスターはリードレプリカに変更されます。
接続ドメイン及び読み取り専用ドメインの情報は、フェイルオーバーが完了した新しいノードを基準に更新されます。フローティングIPドメインは変更されませんが、そのドメインが指すフローティングIPは、新しいマスターを指すように自動的に変更されます。

!!! tip 「ポイント」
   フェイルオーバーは、マスターノードと同じリージョンに属するノードを対象に実行される機能のため、他のリージョンにのみリードレプリカノードを追加した場合は、自動フェイルオーバーをサポートしません。

### レプリケーション接続の強制解除

[[レプリケーション接続強制解除アイコンの画像]]
他のリージョンに追加したリードレプリカノードは、マスターに障害が発生しても自動フェイルオーバーの対象にはなりません。しかし、障害発生時に緊急で他のリージョンにあるリードレプリカノードを使用する必要がある場合、**レプリケーション接続の強制解除**機能を使用し、そのノードをマスターノードに昇格させることができます。
**レプリケーション接続の強制解除**を実行すると、他のリージョンに既存ノードとは別の個別キャッシュが新規作成され、既存のリードレプリカノードがマスターノードに昇格し、新しい接続ドメインが表示されます。

!!! tip 「ポイント」
    * レプリケーション接続の強制解除を実行する場合、強制的にレプリケーション接続タスクを行うため、元のリージョンのキャッシュ及びマスターノードの構成情報との間に不整合が発生する可能性があります。そのため、元のリージョンでの障害発生時のような特殊な場合にのみ使用し、単に他のリージョンのリードレプリカを新しいキャッシュとして分離することが目的であれば、通常のレプリケーション接続解除機能の使用を推奨します。
    * マスターと同じリージョンのリードレプリカは、レプリケーション接続の解除機能をサポートしていません。(今後サポート予定)
